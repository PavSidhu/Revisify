!function(e){var t={sort:!1,"sort-attr":"data-priority","sort-desc":!1,autoselect:!0,"alternative-spellings":!0,"alternative-spellings-attr":"data-alternative-spellings","remove-valueless-options":!0,"copy-attributes-to-text-field":!0,"autocomplete-plugin":"jquery_ui","relevancy-sorting":!0,"relevancy-sorting-partial-match-value":1,"relevancy-sorting-strict-match-value":5,"relevancy-sorting-booster-attr":"data-relevancy-booster",minLength:0,delay:0,autoFocus:!0,handle_invalid_input:function(e){var t="option:selected:first";e.settings["remove-valueless-options"]&&(t='option:selected[value!=""]:first'),e.$text_field.val(e.$select_field.find(t).text())},handle_select_field:function(e){return e.hide()},insert_text_field:function(n){var i=e('<input type="text"></input>');if(t["copy-attributes-to-text-field"]){for(var a={},r=n.$select_field[0].attributes,l=0;l<r.length;l++){var s=r[l].nodeName,o=r[l].nodeValue;"name"!==s&&"id"!==s&&"undefined"!=typeof n.$select_field.attr(s)&&(a[s]=o)}i.attr(a)}i.blur(function(){var a=n.$select_field.find("option").map(function(t,n){return e(n).text()});e.inArray(i.val(),a)<0&&"function"==typeof t.handle_invalid_input&&t.handle_invalid_input(n)}),n.settings.autoselect&&i.click(function(){this.select()});var c="option:selected:first";return n.settings["remove-valueless-options"]&&(c='option:selected[value!=""]:first'),i.val(n.$select_field.find(c).text()).insertAfter(n.$select_field)},extract_options:function(n){var i=[],a=n.find("option"),r=a.length;return a.each(function(){var n=e(this),a={"real-value":n.attr("value"),label:n.text()};if(t["remove-valueless-options"]&&""===a["real-value"]);else{a.matches=a.label;var l=n.attr(t["alternative-spellings-attr"]);if(l&&(a.matches+=" "+l),t.sort){var s=parseInt(n.attr(t["sort-attr"]),10);s?a.weight=s:a.weight=r}if(t["relevancy-sorting"]){a["relevancy-score"]=0,a["relevancy-score-booster"]=1;var o=parseFloat(n.attr(t["relevancy-sorting-booster-attr"]));o&&(a["relevancy-score-booster"]=o)}i.push(a)}}),t.sort&&(t["sort-desc"]?i.sort(function(e,t){return t.weight-e.weight}):i.sort(function(e,t){return e.weight-t.weight})),i}},n={init:function(n){return/msie/.test(navigator.userAgent.toLowerCase())&&parseInt(navigator.appVersion,10)<=6?this:(t=e.extend(t,n),this.each(function(){var n=e(this),a={$select_field:n,options:t.extract_options(n),settings:t};a.$text_field=t.insert_text_field(a),t.handle_select_field(n),"string"==typeof t["autocomplete-plugin"]?i[t["autocomplete-plugin"]](a):t["autocomplete-plugin"](a)}))}},i={jquery_ui:function(t){var n=function(n){for(var i=n.split(" "),a=[],r=0;r<i.length;r++)if(i[r].length>0){var l={};l.partial=new RegExp(e.ui.autocomplete.escapeRegex(i[r]),"i"),t.settings["relevancy-sorting"]&&(l.strict=new RegExp("^"+e.ui.autocomplete.escapeRegex(i[r]),"i")),a.push(l)}return e.grep(t.options,function(e){var i=0;if(t.settings["relevancy-sorting"])var r=!1,l=e.matches.split(" ");for(var s=0;s<a.length;s++)if(a[s].partial.test(e.matches)&&i++,t.settings["relevancy-sorting"])for(var o=0;o<l.length;o++)if(a[s].strict.test(l[o])){r=!0;break}if(t.settings["relevancy-sorting"]){var c=0;c+=i*t.settings["relevancy-sorting-partial-match-value"],r&&(c+=t.settings["relevancy-sorting-strict-match-value"]),c*=e["relevancy-score-booster"],e["relevancy-score"]=c}return!n||a.length===i})},i=function(e){if(e)t.$select_field.val()!==e["real-value"]&&(t.$select_field.val(e["real-value"]),t.$select_field.change());else{for(var n=t.$text_field.val().toLowerCase(),i={"real-value":!1},a=0;a<t.options.length;a++)if(n===t.options[a].label.toLowerCase()){i=t.options[a];break}t.$select_field.val()!==i["real-value"]&&(t.$select_field.val(i["real-value"]||""),t.$select_field.change()),i["real-value"]&&t.$text_field.val(i.label),"function"==typeof t.settings.handle_invalid_input&&""===t.$select_field.val()&&t.settings.handle_invalid_input(t)}};t.$text_field.autocomplete({minLength:t.settings.minLength,delay:t.settings.delay,autoFocus:t.settings.autoFocus,source:function(e,i){var a=n(e.term);t.settings["relevancy-sorting"]&&(a=a.sort(function(e,t){return t["relevancy-score"]==e["relevancy-score"]?t.label<e.label?1:-1:t["relevancy-score"]-e["relevancy-score"]})),i(a)},select:function(e,t){i(t.item)},change:function(e,t){i(t.item)}}),t.$text_field.parents("form:first").submit(function(){i()}),i()}};e.fn.selectToAutocomplete=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.fn.selectToAutocomplete"):n.init.apply(this,arguments)}}(jQuery);
